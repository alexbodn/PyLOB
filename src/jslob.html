<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="shortcut icon" href="data:image/x-icon;," type="image/x-icon">
    <title>Hello, sqlite3</title>
    <style>
      .warning, .error {color: red}
      .error {background-color: yellow}
      body {
          display: flex;
          flex-direction: column;
          font-family: monospace;
          white-space: break-spaces;
      }
    </style>
  </head>
  <body>
    <h1>js lob</h1>
    <script src="sqlitejs/sqlite3.js"></script>
    <!--script src="sqlitejs/demo-123.js"></script-->
	<script src="orderbook.js"></script>
    <script>
		async function fetchText(url) {
			let ret = fetch(url).then(function(response) {
				return response.text();
    		});
    		return ret;
		}
		console.log('hehe');
	if(self.window!==self) /*worker thread*/{
    /*
      If sqlite3.js is in a directory other than this script, in order
      to get sqlite3.js to resolve sqlite3.wasm properly, we have to
      explicitly tell it where sqlite3.js is being loaded from. We do
      that by passing the `sqlite3.dir=theDirName` URL argument to
      _this_ script. That URL argument will be seen by the JS/WASM
      loader and it will adjust the sqlite3.wasm path accordingly. If
      sqlite3.js/.wasm are in the same directory as this script then
      that's not needed.

      URL arguments passed as part of the filename via importScripts()
      are simply lost, and such scripts see the self.location of
      _this_ script.
    */
    let sqlite3Js = 'sqlite3.js';
    const urlParams = new URL(self.location.href).searchParams;
    if(urlParams.has('sqlite3.dir')){
      sqlite3Js = urlParams.get('sqlite3.dir') + '/' + sqlite3Js;
    }
    importScripts(sqlite3Js);
  }
  self.sqlite3InitModule({
    // We can redirect any stdout/stderr from the module
    // like so...
    print: console.log,
    printErr: console.error
  }).then(function(sqlite3){
    //console.log('sqlite3 =',sqlite3);
    //log("Done initializing. Running demo...");
    try {
      let myurl = window.location.href;
		let mydir = myurl.substring(0,myurl.lastIndexOf('/'));
		const oo = sqlite3.oo1/*high-level OO API*/;
		const db = new oo.DB("/mydb.sqlite3",'ct');
		let ob = new OrderBook(mydir + '/PyLOB', fetchText, db, );
    }catch(e){
      console.error("Exception:",e.message);
    }
  });
    </script>
  </body>
</html>
